import java.net.HttpURLConnection;
import java.net.URL;
import java.net.URLEncoder;
import java.nio.charset.StandardCharsets;
import java.util.Scanner;
import org.json.simple.JSONObject;
import org.json.simple.parser.JSONParser;
import java.util.HashMap;
import java.util.Map;
import java.time.LocalDate;
import org.json.simple.JSONArray;

public class WeatherAPI {
    private static final String apiKey = "6644bf41da75738bfb18480baf46f669";
    private static final String weatherAPIURL = "https://api.openweathermap.org/data/2.5/forecast";

    /*To take the API you need to;
    Create the URL and send the reuqest,
    Check the response (make the code with catching an error),
    Read the response and parse the Json, (you use the StringBuilder here)
    For Loop to see the Json and take what you want,
    */
    public static Map<LocalDate, String> getWeatherForecast(String city) {
        Map<LocalDate, String> forecastMap = new HashMap<>();
        try {
            // Creating the URL and the request

            // You created the URL here and send the request to weatherAPI
            String theCity = URLEncoder.encode(city, StandardCharsets.UTF_8.toString());
            URL url = new URL(weatherAPIURL + "?q=" + theCity + "&appid=" + /*consists of APIKEY here*/
                    apiKey + /*metric system*/"&units=metric");

            //creating the Http connection using the URL above (that consists of which city the user wants to search)
            HttpURLConnection connection = (HttpURLConnection) url.openConnection();

            //creating the GET for the data retrieved later on
            connection.setRequestMethod("GET");

            //connecting to server
            connection.connect();

            //Check the response (make the code with catching an error)

            //Checking the response, if the response is NOT 200, that means there is a problem fecthing the data
            int responseCode = connection.getResponseCode();
            if (responseCode != 200) {
                System.out.println("Error fetching weather: HTTP response code " + responseCode);
                return forecastMap;
            }

            //Read the response and parse the Json, (you use the StringBuilder here)

            //Creating StringBuilder that consists of the data from the weatherAPI server
            StringBuilder data = new StringBuilder(); /*you save the data in the String here which will be read by
                                                        scanner below*/
            Scanner scanner = new Scanner(url.openStream());/*openStream is the stream that is given from weather API*/

            while (scanner.hasNext()) {
                data.append(scanner.nextLine());
            }
            scanner.close();

            //Parsing the Json, taking the weather data
            JSONParser parser = new JSONParser();
            //making jsonData (String) to be jsonObject
            JSONObject jasonData = (JSONObject) parser.parse(data.toString());
            //making jsonObject into an Array to be later used to reiterate and find the dates and weather
            JSONArray list = (JSONArray) jasonData.get("list");

            //System.out.println(list);

            //For Loop to see the Json and take what you want,

            for (Object serverDatafromWeatherAPI : list){
                JSONObject theList = (JSONObject) serverDatafromWeatherAPI;
                //take the info here
                //Will have to look at the WeatherAPI for all the codes
                /*[{"dt":1703019600,"pop":0,"visibility":10000,"dt_txt":"2023-12-19 21:00:00","weather":[{"icon":"04n",
                "description":"overcast clouds","main":"Clouds","id":804}],"main":{"temp":28.97,"temp_min":27.84,"grnd_level":1007,"temp_kf":1.13,"humidity":62,"pressure":1010,"sea_level":1010,"feels_like":31.29,"temp_max":28.97},"clouds":{"all":100},"sys":{"pod":"n"},"wind":{"deg":223,"speed":2.26,"gust":2.46}},{"dt":1703030400,"pop":0,"visibility":10000,"dt_txt":"2023-12-20 00:00:00","weather":[{"icon":"04d","description":"overcast clouds","main":"Clouds","id":804}],"main":{"temp":28.59,"temp_min":28.12,"grnd_level":1009,"temp_kf":0.47,"humidity":59,"pressure":1011,"sea_level":1011,"feels_like":30.22,"temp_max":28.59},"clouds":{"all":87},"sys":{"pod":"d"},"wind":{"deg":197,"speed":1.71,"gust":1.86}},{"dt":1703041200,"pop":0,"visibility":10000,"dt_txt":"2023-12-20 03:00:00","weather":[{"icon":"04d","description":"overcast clouds","main":"Clouds","id":804}],"main":{"temp":32.1,"temp_min":32.1,"grnd_level":1009,"temp_kf":0,"humidity":45,"pressure":1011,"sea_level":1011,"feels_like":33.41,"temp_max":32.1},"clouds":{"all":87},"sys":{"pod":"d"},"wind":{"deg":303,"speed":0.28,"gust":0.98}},{"dt":1703052000,"pop":0,"visibility":10000,"dt_txt":"2023-12-20 06:00:00","weather":[{"icon":"04d","description":"overcast clouds","main":"Clouds","id":804}],"main":{"temp":34.28,"temp_min":34.28,"grnd_level":1007,"temp_kf":0,"humidity":39,"pressure":1008,"sea_level":1008,"feels_like":35.65,"temp_max":34.28},"clouds":{"all":88},"sys":{"pod":"d"},"wind":{"deg":345,"speed":3.04,"gust":2.57}},{"dt":1703062800,"pop":0,"visibility":10000,"dt_txt":"2023-12-20 09:00:00","weather":[{"icon":"04d","description":"overcast clouds","main":"Clouds","id":804}],"main":{"temp":32.34,"temp_min":32.34,"grnd_level":1004,"temp_kf":0,"humidity":50,"pressure":1006,"sea_level":1006,"feels_like":35,"temp_max":32.34},"clouds":{"all":100},"sys":{"pod":"d"},"wind":{"deg":359,"speed":5.88,"gust":4.25}},{"dt":1703073600,"pop":0,"visibility":10000,"dt_txt":"2023-12-20 12:00:00","weather":[{"icon":"04n","description":"overcast clouds","main":"Clouds","id":804}],"main":{"temp":30.34,"temp_min":30.34,"grnd_level":1007,"temp_kf":0,"humidity":57,"pressure":1008,"sea_level":1008,"feels_like":32.87,"temp_max":30.34},"clouds":{"all":97},"sys":{"pod":"n"},"wind":{"deg":354,"speed":3.5,"gust":3.44}},{"dt":1703084400,"pop":0.12,"visibility":10000,"dt_txt":"2023-12-20 15:00:00","weather":[{"icon":"04n","description":"broken clouds","main":"Clouds","id":803}],"main":{"temp":29.6,"temp_min":29.6,"grnd_level":1009,"temp_kf":0,"humidity":59,"pressure":1010,"sea_level":1010,"feels_like":31.91,"temp_max":29.6},"clouds":{"all":72},"sys":{"pod":"n"},"wind":{"deg":43,"speed":1.55,"gust":1.98}},{"dt":1703095200,"pop":0.1,"visibility":10000,"dt_txt":"2023-12-20 18:00:00","weather":[{"icon":"04n","description":"broken clouds","main":"Clouds","id":803}],"main":{"temp":28.91,"temp_min":28.91,"grnd_level":1007,"temp_kf":0,"humidity":64,"pressure":1009,"sea_level":1009,"feels_like":31.5,"temp_max":28.91},"clouds":{"all":78},"sys":{"pod":"n"},"wind":{"deg":76,"speed":1.5,"gust":1.91}},{"dt":1703106000,"pop":0,"visibility":10000,"dt_txt":"2023-12-20 21:00:00","weather":[{"icon":"04n","description":"broken clouds","main":"Clouds","id":803}],"main":{"temp":28.32,"temp_min":28.32,"grnd_level":1007,"temp_kf":0,"humidity":68,"pressure":1008,"sea_level":1008,"feels_like":31.01,"temp_max":28.32},"clouds":{"all":75},"sys":{"pod":"n"},"wind":{"deg":112,"speed":0.62,"gust":1.27}},{"dt":1703116800,"pop":0,"visibility":10000,"dt_txt":"2023-12-21 00:00:00","weather":[{"icon":"04d","description":"broken clouds","main":"Clouds","id":803}],"main":{"temp":28.47,"temp_min":28.47,"grnd_level":1009,"temp_kf":0,"humidity":68,"pressure":1010,"sea_level":1010,"feels_like":31.3,"temp_max":28.47},"clouds":{"all":63},"sys":{"pod":"d"},"wind":{"deg":154,"speed":0.64,"gust":1.37}},{"dt":1703127600,"pop":0,"visibility":10000,"dt_txt":"2023-12-21 03:00:00","weather":[{"icon":"04d","description":"overcast clouds","main":"Clouds","id":804}],"main":{"temp":31.88,"temp_min":31.88,"grnd_level":1009,"temp_kf":0,"humidity":53,"pressure":1010,"sea_level":1010,"feels_like":34.88,"temp_max":31.88},"clouds":{"all":86},"sys":{"pod":"d"},"wind":{"deg":351,"speed":1.46,"gust":1.22}},{"dt":1703138400,"pop":0,"visibility":10000,"dt_txt":"2023-12-21 06:00:00","weather":[{"icon":"04d","description":"broken clouds","main":"Clouds","id":803}],"main":{"temp":33.45,"temp_min":33.45,"grnd_level":1006,"temp_kf":0,"humidity":47,"pressure":1008,"sea_level":1008,"feels_like":36.32,"temp_max":33.45},"clouds":{"all":57},"sys":{"pod":"d"},"wind":{"deg":2,"speed":4.56,"gust":3.31}},{"dt":1703149200,"pop":0,"visibility":10000,"dt_txt":"2023-12-21 09:00:00","weather":[{"icon":"04d","description":"broken clouds","main":"Clouds","id":803}],"main":{"temp":31.93,"temp_min":31.93,"grnd_level":1005,"temp_kf":0,"humidity":55,"pressure":1007,"sea_level":1007,"feels_like":35.5,"temp_max":31.93},"clouds":{"all":69},"sys":{"pod":"d"},"wind":{"deg":3,"speed":5.08,"gust":3.8}},{"dt":1703160000,"pop":0.2,"visibility":10000,"dt_txt":"2023-12-21 12:00:00","weather":[{"icon":"04n","description":"broken clouds","main":"Clouds","id":803}],"main":{"temp":30.29,"temp_min":30.29,"grnd_level":1008,"temp_kf":0,"humidity":57,"pressure":1009,"sea_level":1009,"feels_like":32.77,"temp_max":30.29},"clouds":{"all":80},"sys":{"pod":"n"},"wind":{"deg":355,"speed":3.1,"gust":2.82}},{"dt":1703170800,"pop":0.1,"visibility":10000,"dt_txt":"2023-12-21 15:00:00","weather":[{"icon":"04n","description":"overcast clouds","main":"Clouds","id":804}],"main":{"temp":29.63,"temp_min":29.63,"grnd_level":1009,"temp_kf":0,"humidity":60,"pressure":1011,"sea_level":1011,"feels_like":32.14,"temp_max":29.63},"clouds":{"all":88},"sys":{"pod":"n"},"wind":{"deg":40,"speed":2.18,"gust":1.82}},{"dt":1703181600,"pop":0.01,"visibility":10000,"dt_txt":"2023-12-21 18:00:00","weather":[{"icon":"04n","description":"overcast clouds","main":"Clouds","id":804}],"main":{"temp":29.04,"temp_min":29.04,"grnd_level":1008,"temp_kf":0,"humidity":64,"pressure":1009,"sea_level":1009,"feels_like":31.75,"temp_max":29.04},"clouds":{"all":94},"sys":{"pod":"n"},"wind":{"deg":36,"speed":1.49,"gust":1.21}},{"dt":1703192400,"pop":0,"visibility":10000,"dt_txt":"2023-12-21 21:00:00","weather":[{"icon":"04n","description":"overcast clouds","main":"Clouds","id":804}],"main":{"temp":28.64,"temp_min":28.64,"grnd_level":1007,"temp_kf":0,"humidity":66,"pressure":1009,"sea_level":1009,"feels_like":31.32,"temp_max":28.64},"clouds":{"all":100},"sys":{"pod":"n"},"wind":{"deg":95,"speed":0.87,"gust":1.25}},{"dt":1703203200,"pop":0,"visibility":10000,"dt_txt":"2023-12-22 00:00:00","weather":[{"icon":"04d","description":"overcast clouds","main":"Clouds","id":804}],"main":{"temp":28.87,"temp_min":28.87,"grnd_level":1009,"temp_kf":0,"humidity":66,"pressure":1011,"sea_level":1011,"feels_like":31.76,"temp_max":28.87},"clouds":{"all":96},"sys":{"pod":"d"},"wind":{"deg":224,"speed":0.33,"gust":0.93}},{"dt":1703214000,"pop":0.01,"visibility":10000,"dt_txt":"2023-12-22 03:00:00","weather":[{"icon":"04d","description":"broken clouds","main":"Clouds","id":803}],"main":{"temp":31.88,"temp_min":31.88,"grnd_level":1010,"temp_kf":0,"humidity":55,"pressure":1011,"sea_level":1011,"feels_like":35.39,"temp_max":31.88},"clouds":{"all":81},"sys":{"pod":"d"},"wind":{"deg":321,"speed":2,"gust":1.43}},{"dt":1703224800,"pop":0.31,"rain":{"3h":0.1},"visibility":10000,"dt_txt":"2023-12-22 06:00:00","weather":[{"icon":"10d","description":"light rain","main":"Rain","id":500}],"main":{"temp":32.58,"temp_min":32.58,"grnd_level":1007,"temp_kf":0,"humidity":52,"pressure":1009,"sea_level":1009,"feels_like":36.01,"temp_max":32.58},"clouds":{"all":91},"sys":{"pod":"d"},"wind":{"deg":348,"speed":4.47,"gust":3.42}},{"dt":1703235600,"pop":0.27,"visibility":10000,"dt_txt":"2023-12-22 09:00:00","weather":[{"icon":"04d","description":"overcast clouds","main":"Clouds","id":804}],"main":{"temp":31.08,"temp_min":31.08,"grnd_level":1006,"temp_kf":0,"humidity":57,"pressure":1008,"sea_level":1008,"feels_like":34.28,"temp_max":31.08},"clouds":{"all":100},"sys":{"pod":"d"},"wind":{"deg":341,"speed":4.29,"gust":3.77}},{"dt":1703246400,"pop":0.34,"rain":{"3h":0.1},"visibility":10000,"dt_txt":"2023-12-22 12:00:00","weather":[{"icon":"10n","description":"light rain","main":"Rain","id":500}],"main":{"temp":30.28,"temp_min":30.28,"grnd_level":1009,"temp_kf":0,"humidity":57,"pressure":1010,"sea_level":1010,"feels_like":32.76,"temp_max":30.28},"clouds":{"all":100},"sys":{"pod":"n"},"wind":{"deg":341,"speed":3.81,"gust":3.96}},{"dt":1703257200,"pop":0.3,"visibility":10000,"dt_txt":"2023-12-22 15:00:00","weather":[{"icon":"04n","description":"overcast clouds","main":"Clouds","id":804}],"main":{"temp":29.38,"temp_min":29.38,"grnd_level":1010,"temp_kf":0,"humidity":62,"pressure":1012,"sea_level":1012,"feels_like":32.04,"temp_max":29.38},"clouds":{"all":100},"sys":{"pod":"n"},"wind":{"deg":285,"speed":3.21,"gust":3.57}},{"dt":1703268000,"pop":0.32,"rain":{"3h":0.24},"visibility":10000,"dt_txt":"2023-12-22 18:00:00","weather":[{"icon":"10n","description":"light rain","main":"Rain","id":500}],"main":{"temp":28.49,"temp_min":28.49,"grnd_level":1009,"temp_kf":0,"humidity":67,"pressure":1011,"sea_level":1011,"feels_like":31.18,"temp_max":28.49},"clouds":{"all":100},"sys":{"pod":"n"},"wind":{"deg":278,"speed":1.17,"gust":1.4}},{"dt":1703278800,"pop":0.2,"visibility":10000,"dt_txt":"2023-12-22 21:00:00","weather":[{"icon":"04n","description":"broken clouds","main":"Clouds","id":803}],"main":{"temp":28.33,"temp_min":28.33,"grnd_level":1008,"temp_kf":0,"humidity":68,"pressure":1010,"sea_level":1010,"feels_like":31.02,"temp_max":28.33},"clouds":{"all":59},"sys":{"pod":"n"},"wind":{"deg":197,"speed":0.62,"gust":1.72}},{"dt":1703289600,"pop":0.16,"visibility":10000,"dt_txt":"2023-12-23 00:00:00","weather":[{"icon":"04d","description":"broken clouds","main":"Clouds","id":803}],"main":{"temp":28.64,"temp_min":28.64,"grnd_level":1010,"temp_kf":0,"humidity":66,"pressure":1011,"sea_level":1011,"feels_like":31.32,"temp_max":28.64},"clouds":{"all":71},"sys":{"pod":"d"},"wind":{"deg":115,"speed":1.51,"gust":2.23}},{"dt":1703300400,"pop":0.01,"visibility":10000,"dt_txt":"2023-12-23 03:00:00","weather":[{"icon":"04d","description":"overcast clouds","main":"Clouds","id":804}],"main":{"temp":31.62,"temp_min":31.62,"grnd_level":1009,"temp_kf":0,"humidity":55,"pressure":1011,"sea_level":1011,"feels_like":34.87,"temp_max":31.62},"clouds":{"all":100},"sys":{"pod":"d"},"wind":{"deg":63,"speed":1.79,"gust":2.09}},{"dt":1703311200,"pop":0.02,"visibility":10000,"dt_txt":"2023-12-23 06:00:00","weather":[{"icon":"04d","description":"overcast clouds","main":"Clouds","id":804}],"main":{"temp":33.45,"temp_min":33.45,"grnd_level":1007,"temp_kf":0,"humidity":49,"pressure":1008,"sea_level":1008,"feels_like":36.91,"temp_max":33.45},"clouds":{"all":90},"sys":{"pod":"d"},"wind":{"deg":22,"speed":3.7,"gust":3.42}},{"dt":1703322000,"pop":0.27,"visibility":10000,"dt_txt":"2023-12-23 09:00:00","weather":[{"icon":"04d","description":"overcast clouds","main":"Clouds","id":804}],"main":{"temp":31.77,"temp_min":31.77,"grnd_level":1006,"temp_kf":0,"humidity":58,"pressure":1008,"sea_level":1008,"feels_like":35.98,"temp_max":31.77},"clouds":{"all":96},"sys":{"pod":"d"},"wind":{"deg":22,"speed":4.56,"gust":3.97}},{"dt":1703332800,"pop":0.61,"rain":{"3h":3.89},"visibility":10000,"dt_txt":"2023-12-23 12:00:00","weather":[{"icon":"10n","description":"moderate rain","main":"Rain","id":501}],"main":{"temp":29.08,"temp_min":29.08,"grnd_level":1008,"temp_kf":0,"humidity":70,"pressure":1010,"sea_level":1010,"feels_like":32.9,"temp_max":29.08},"clouds":{"all":98},"sys":{"pod":"n"},"wind":{"deg":14,"speed":2.17,"gust":2.51}},{"dt":1703343600,"pop":0.8,"rain":{"3h":5.56},"visibility":10000,"dt_txt":"2023-12-23 15:00:00","weather":[{"icon":"10n","description":"moderate rain","main":"Rain","id":501}],"main":{"temp":28.6,"temp_min":28.6,"grnd_level":1010,"temp_kf":0,"humidity":71,"pressure":1011,"sea_level":1011,"feels_like":32.04,"temp_max":28.6},"clouds":{"all":100},"sys":{"pod":"n"},"wind":{"deg":32,"speed":1.06,"gust":1.44}},{"dt":1703354400,"pop":0.79,"rain":{"3h":0.58},"visibility":10000,"dt_txt":"2023-12-23 18:00:00","weather":[{"icon":"10n","description":"light rain","main":"Rain","id":500}],"main":{"temp":28.43,"temp_min":28.43,"grnd_level":1008,"temp_kf":0,"humidity":72,"pressure":1010,"sea_level":1010,"feels_like":31.84,"temp_max":28.43},"clouds":{"all":98},"sys":{"pod":"n"},"wind":{"deg":99,"speed":1.26,"gust":1.38}},{"dt":1703365200,"pop":0.43,"rain":{"3h":0.11},"visibility":10000,"dt_txt":"2023-12-23 21:00:00","weather":[{"icon":"10n","description":"light rain","main":"Rain","id":500}],"main":{"temp":27.88,"temp_min":27.88,"grnd_level":1007,"temp_kf":0,"humidity":74,"pressure":1009,"sea_level":1009,"feels_like":30.96,"temp_max":27.88},"clouds":{"all":79},"sys":{"pod":"n"},"wind":{"deg":113,"speed":1.56,"gust":1.64}},{"dt":1703376000,"pop":0.53,"rain":{"3h":0.87},"visibility":10000,"dt_txt":"2023-12-24 00:00:00","weather":[{"icon":"10d","description":"light rain","main":"Rain","id":500}],"main":{"temp":28.39,"temp_min":28.39,"grnd_level":1009,"temp_kf":0,"humidity":71,"pressure":1011,"sea_level":1011,"feels_like":31.59,"temp_max":28.39},"clouds":{"all":89},"sys":{"pod":"d"},"wind":{"deg":108,"speed":1.98,"gust":2.17}},{"dt":1703386800,"pop":0.14,"visibility":10000,"dt_txt":"2023-12-24 03:00:00","weather":[{"icon":"04d","description":"overcast clouds","main":"Clouds","id":804}],"main":{"temp":31.51,"temp_min":31.51,"grnd_level":1010,"temp_kf":0,"humidity":58,"pressure":1011,"sea_level":1011,"feels_like":35.42,"temp_max":31.51},"clouds":{"all":97},"sys":{"pod":"d"},"wind":{"deg":48,"speed":2.11,"gust":2.11}},{"dt":1703397600,"pop":0.58,"rain":{"3h":0.25},"visibility":10000,"dt_txt":"2023-12-24 06:00:00","weather":[{"icon":"10d","description":"light rain","main":"Rain","id":500}],"main":{"temp":31.65,"temp_min":31.65,"grnd_level":1008,"temp_kf":0,"humidity":57,"pressure":1009,"sea_level":1009,"feels_like":35.45,"temp_max":31.65},"clouds":{"all":99},"sys":{"pod":"d"},"wind":{"deg":8,"speed":5.01,"gust":3.58}},{"dt":1703408400,"pop":0.61,"rain":{"3h":1.04},"visibility":10000,"dt_txt":"2023-12-24 09:00:00","weather":[{"icon":"10d","description":"light rain","main":"Rain","id":500}],"main":{"temp":30.98,"temp_min":30.98,"grnd_level":1007,"temp_kf":0,"humidity":61,"pressure":1008,"sea_level":1008,"feels_like":35.05,"temp_max":30.98},"clouds":{"all":100},"sys":{"pod":"d"},"wind":{"deg":6,"speed":3.91,"gust":3.41}},{"dt":1703419200,"pop":0.85,"rain":{"3h":4.14},"visibility":10000,"dt_txt":"2023-12-24 12:00:00","weather":[{"icon":"10n","description":"moderate rain","main":"Rain","id":501}],"main":{"temp":28.9,"temp_min":28.9,"grnd_level":1009,"temp_kf":0,"humidity":71,"pressure":1010,"sea_level":1010,"feels_like":32.69,"temp_max":28.9},"clouds":{"all":100},"sys":{"pod":"n"},"wind":{"deg":350,"speed":1.95,"gust":2.47}},{"dt":1703430000,"pop":0.73,"rain":{"3h":1.98},"visibility":10000,"dt_txt":"2023-12-24 15:00:00","weather":[{"icon":"10n","description":"light rain","main":"Rain","id":500}],"main":{"temp":28.75,"temp_min":28.75,"grnd_level":1010,"temp_kf":0,"humidity":71,"pressure":1011,"sea_level":1011,"feels_like":32.36,"temp_max":28.75},"clouds":{"all":81},"sys":{"pod":"n"},"wind":{"deg":12,"speed":1.67,"gust":2.22}},{"dt":1703440800,"pop":0.9,"rain":{"3h":0.61},"visibility":10000,"dt_txt":"2023-12-24 18:00:00","weather":[{"icon":"10n","description":"light rain","main":"Rain","id":500}],"main":{"temp":28.2,"temp_min":28.2,"grnd_level":1008,"temp_kf":0,"humidity":74,"pressure":1010,"sea_level":1010,"feels_like":31.65,"temp_max":28.2},"clouds":{"all":67},"sys":{"pod":"n"},"wind":{"deg":25,"speed":0.92,"gust":1.32}}]*/
                String date = (String) theList.get("dt_txt");
                LocalDate dates = LocalDate.parse(date.split(" ")[0]);

                //Because temperature is in the main array, so you take the main array first
                JSONObject main = (JSONObject) theList.get("main");
                String celcius = main.get("temp") + " Degrees";

                forecastMap.put(dates, celcius);
            }

        } catch (Exception e) {
            e.printStackTrace();
        }
        return forecastMap;
    }

}